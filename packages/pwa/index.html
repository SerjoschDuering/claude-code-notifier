<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="theme-color" content="#0a0c10">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Claude Approve">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <title>Claude Code Approver</title>

  <!-- Fonts: Outfit for UI, JetBrains Mono for code -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div class="app">
    <!-- Ambient background -->
    <div class="ambient-glow"></div>

    <!-- Header - minimal, always visible -->
    <header class="header">
      <div class="header-brand">
        <span class="header-icon">âš¡</span>
        <span class="header-title">Claude Approve</span>
      </div>
      <div class="header-actions">
        <button id="settings-trigger" class="icon-btn" aria-label="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.25M15.54 15.54l4.24 4.25M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="main">

      <!-- ========== WELCOME MODAL ========== -->
      <div id="welcome-modal" class="welcome-overlay hidden">
        <div class="welcome-card">
          <img src="/assets/cc-approval-s.jpg" alt="Claude Code approval flow" class="welcome-image">
          <div class="welcome-content">
            <h1 class="welcome-title">Claude Approve</h1>
            <p class="welcome-subtitle">Free â€¢ Fast â€¢ Open Source</p>
            <p class="welcome-desc">
              Push notifications when Claude Code needs approval. Approve or deny from anywhere.
            </p>
            <div class="welcome-features-inline">
              <span class="feature-chip">ğŸ†“ Free</span>
              <span class="feature-chip">âš¡ Instant</span>
              <span class="feature-chip">ğŸ“– Open Source</span>
            </div>
            <button id="welcome-start" class="btn-primary btn-glow">
              <span class="btn-text">Get Started</span>
              <span class="btn-icon">â†’</span>
            </button>
            <a href="https://github.com/SerjoschDuering/claude-code-notifier" target="_blank" rel="noopener" class="github-badge">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
              </svg>
              <span>Open Source</span>
            </a>
            <p class="welcome-trust">ğŸ”’ Credentials generated locally</p>
          </div>
        </div>
      </div>

      <!-- ========== ADD TO HOME SCREEN (First-time browser users) ========== -->
      <section id="add-to-homescreen" class="screen aths-screen hidden">
        <div class="aths-hero">
          <div class="hero-badge">
            <span class="badge-icon">ğŸ“±</span>
          </div>
          <h1 class="hero-title">Add to Home Screen</h1>
          <p class="hero-desc">Install this app first to enable push notifications and secure credential storage.</p>
        </div>

        <div class="aths-card">
          <div id="aths-instructions" class="aths-instructions">
            <!-- Populated by JS based on platform -->
          </div>
        </div>

        <div class="aths-why">
          <p class="why-title">Why install first?</p>
          <ul class="why-list">
            <li>ğŸ” Credentials stored securely in app</li>
            <li>ğŸ”” Push notifications require installed app</li>
            <li>âš¡ Faster access from home screen</li>
          </ul>
        </div>

        <div class="aths-footer">
          <p class="aths-note">After installing, open the app from your home screen to continue setup.</p>
          <button id="aths-skip-btn" class="btn-ghost aths-skip">
            Skip for now (notifications may not work)
          </button>
        </div>
      </section>

      <!-- ========== ONBOARDING WIZARD ========== -->
      <section id="onboarding" class="screen onboarding hidden">
        <!-- Progress indicator (4 steps now) -->
        <div class="wizard-progress">
          <div class="progress-step active" data-step="0">
            <span class="step-num">1</span>
            <span class="step-label">Pair</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="1">
            <span class="step-num">2</span>
            <span class="step-label">Notify</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <span class="step-num">3</span>
            <span class="step-label">Test</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <span class="step-num">4</span>
            <span class="step-label">Copy</span>
          </div>
        </div>

        <!-- Step 0: Pair Device (NEW - Explicit pairing with visible ID) -->
        <div id="step-0" class="wizard-step active">
          <div class="step-hero">
            <div class="hero-badge">
              <span class="badge-icon">ğŸ”—</span>
            </div>
            <h1 class="hero-title">Pair Device</h1>
            <p class="hero-desc">Create a unique pairing ID to connect this device with Claude Code.</p>
          </div>

          <div class="action-card">
            <button id="pair-device-btn" class="btn-primary btn-glow">
              <span class="btn-icon">ğŸ”—</span>
              <span class="btn-text">Pair This Device</span>
            </button>
          </div>

          <div class="pairing-status" id="pairing-status">
            <span class="status-icon">â³</span>
            <span class="status-text">Not paired yet</span>
          </div>

          <!-- Pairing ID display (hidden until paired) -->
          <div id="pairing-id-display" class="pairing-id-display hidden">
            <div class="pairing-id-label">Your Pairing ID</div>
            <div class="pairing-id-value">
              <code id="pairing-id-code">â€”</code>
              <button id="copy-pairing-id" class="copy-id-btn" title="Copy full ID">ğŸ“‹</button>
            </div>
            <div class="pairing-id-hint">Save this ID to verify your connection</div>
          </div>

          <button id="next-step-0" class="btn-secondary" disabled>
            Continue â†’
          </button>
        </div>

        <!-- Step 1: Enable Notifications -->
        <div id="step-1" class="wizard-step">
          <div class="step-hero">
            <div class="hero-badge">
              <span class="badge-icon">ğŸ””</span>
            </div>
            <h1 class="hero-title">Enable Notifications</h1>
            <p class="hero-desc">Get instant alerts when Claude Code needs approval.</p>
          </div>

          <div class="action-card">
            <button id="enable-notifications-btn" class="btn-primary btn-glow">
              <span class="btn-icon">ğŸ””</span>
              <span class="btn-text">Enable Push Notifications</span>
            </button>
          </div>

          <div class="notification-status" id="notification-status">
            <span class="status-icon">â³</span>
            <span class="status-text">Not enabled yet</span>
          </div>

          <div class="step-actions">
            <button id="prev-step-1" class="btn-ghost">â† Back</button>
            <button id="next-step-1" class="btn-secondary" disabled>Continue â†’</button>
          </div>
        </div>

        <!-- Step 2: Test Notification -->
        <div id="step-2" class="wizard-step">
          <div class="step-hero">
            <div class="hero-badge">
              <span class="badge-icon">âœ…</span>
            </div>
            <h1 class="hero-title">Test Connection</h1>
            <p class="hero-desc">Send a test notification to verify everything works.</p>
          </div>

          <div class="action-card">
            <button id="send-test-btn" class="btn-primary btn-glow">
              <span class="btn-icon">ğŸ“¤</span>
              <span class="btn-text">Send Test Notification</span>
            </button>
            <p class="action-hint">You should receive it within seconds</p>
          </div>

          <div class="test-status" id="test-status">
            <span class="status-icon">â³</span>
            <span class="status-text">Not tested yet</span>
          </div>

          <div class="step-actions">
            <button id="prev-step-2" class="btn-ghost">â† Back</button>
            <button id="next-step-2" class="btn-secondary" disabled>Continue â†’</button>
          </div>
        </div>

        <!-- Step 3: Copy Setup Prompt -->
        <div id="step-3" class="wizard-step">
          <div class="step-hero">
            <div class="hero-badge">
              <span class="badge-pulse"></span>
              <span class="badge-icon">ğŸ“‹</span>
            </div>
            <h1 class="hero-title">Copy Setup Prompt</h1>
            <p class="hero-desc">Paste this into Claude Code to configure the hook with your unique credentials.</p>
          </div>

          <div class="action-card">
            <button id="copy-prompt-btn" class="btn-primary btn-glow">
              <span class="btn-icon">ğŸ“‹</span>
              <span class="btn-text">Copy to Clipboard</span>
            </button>
            <p class="action-hint">Your credentials are already embedded</p>
          </div>

          <details class="prompt-preview">
            <summary class="preview-toggle">
              <span>Preview prompt</span>
              <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </summary>
            <pre class="preview-code"><code id="prompt-code"></code></pre>
          </details>

          <div class="step-actions">
            <button id="prev-step-3" class="btn-ghost">â† Back</button>
            <button id="finish-setup" class="btn-secondary">I've pasted into Claude Code â†’</button>
          </div>
        </div>
      </section>

      <!-- ========== DASHBOARD (After Setup) ========== -->
      <section id="dashboard" class="screen dashboard hidden">
        <!-- Connection Status Bar -->
        <div class="status-bar">
          <div class="status-indicator">
            <span class="status-dot" id="connection-dot"></span>
            <span class="status-label" id="connection-label">Connected</span>
          </div>
          <button id="refresh-btn" class="icon-btn-sm" aria-label="Refresh">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
          </button>
        </div>

        <!-- Push Permission Banner (if needed) -->
        <div id="push-banner" class="push-banner hidden">
          <span class="banner-icon">ğŸ””</span>
          <span class="banner-text">Enable notifications for approval alerts</span>
          <button id="banner-enable-push" class="btn-sm">Enable</button>
        </div>

        <!-- Pending Requests -->
        <div class="requests-container">
          <h2 class="section-title">Pending Requests</h2>
          <div id="requests-list" class="requests-list">
            <div class="empty-state">
              <span class="empty-icon">âœ¨</span>
              <p class="empty-text">No pending requests</p>
              <p class="empty-hint">Requests appear when Claude Code needs approval</p>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- ========== SETTINGS DRAWER ========== -->
    <div id="settings-drawer" class="drawer hidden">
      <div class="drawer-backdrop"></div>
      <div class="drawer-panel">
        <div class="drawer-header">
          <h2>Settings</h2>
          <button id="close-drawer" class="icon-btn" aria-label="Close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        <div class="drawer-body">
          <!-- Connection Info -->
          <div class="settings-section">
            <h3 class="settings-title">Connection</h3>
            <div class="settings-row">
              <span class="row-label">Status</span>
              <span class="row-value">
                <span class="status-dot connected" id="settings-status-dot"></span>
                <span id="settings-status-text">Connected</span>
              </span>
            </div>
            <div class="settings-row">
              <span class="row-label">Pairing ID</span>
              <code class="row-code" id="settings-pairing-id">â€”</code>
            </div>
          </div>

          <!-- Actions -->
          <div class="settings-section">
            <h3 class="settings-title">Actions</h3>
            <button id="test-notification-btn" class="settings-btn">
              <span>ğŸ””</span> Test Notification
            </button>
            <button id="copy-prompt-settings" class="settings-btn">
              <span>ğŸ“‹</span> Copy Setup Prompt
            </button>
            <button id="regenerate-btn" class="settings-btn warning">
              <span>ğŸ”„</span> Regenerate Credentials
            </button>
            <button id="unpair-btn" class="settings-btn danger">
              <span>ğŸ—‘ï¸</span> Unpair Device
            </button>
          </div>

          <!-- About -->
          <div class="settings-section">
            <h3 class="settings-title">About</h3>
            <a href="https://github.com/SerjoschDuering/claude-code-notifier" target="_blank" rel="noopener" class="settings-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
              </svg>
              View on GitHub
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
