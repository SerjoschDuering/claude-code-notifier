<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Claude Approve">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <title>Claude Code Approver</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">‚ö°</div>
      <div class="header-text">
        <h1>Claude Code Approver</h1>
      </div>
      <div class="header-actions">
        <button id="info-btn" class="header-btn" title="How it works">‚ÑπÔ∏è</button>
        <button id="settings-btn" class="header-btn hidden" title="Settings">‚öôÔ∏è</button>
      </div>
    </header>

    <section class="hero">
      <div class="hero-copy">
        <p class="hero-tag">Remote approvals for Claude Code</p>
        <h2>Approve from anywhere</h2>
        <p>Send every Claude Code permission request to your phone, review the context, and tap Approve or Deny in seconds.</p>
        <div class="hero-actions">
          <a href="/pair.html" class="button primary hero-primary">Pair Device</a>
          <button id="info-btn-secondary" class="button secondary">How it works</button>
        </div>
      </div>
      <div class="hero-art">
        <img src="/assets/cc-approval-b.jpg" alt="Claude Code remote approval illustration">
      </div>
    </section>

    <section class="guide">
      <h2>Setup overview</h2>
      <ol>
        <li>Deploy the Cloudflare Worker (includes Durable Objects + push secrets).</li>
        <li>Deploy this PWA on Cloudflare Pages and add it to your iPhone Home Screen.</li>
        <li>Pair your phone via the CLI QR code.</li>
        <li>Install the Claude Code hook so every Bash/Write/Edit request pauses for approval.</li>
      </ol>
      <p class="guide-note">Need the full walkthrough? <a href="https://github.com/SerjoschDuering/claude-code-notifier#step-by-step-install" target="_blank" rel="noopener">Read the README install guide</a>.</p>
      <div class="guide-script">
        <div class="guide-script-header">
          <span>Copy-ready Claude install script</span>
          <button id="copy-installer" class="button secondary">Copy</button>
        </div>
        <pre><code id="installer-snippet"></code></pre>
      </div>
    </section>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="modal-close" id="close-settings">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="settings-row">
            <span class="settings-label">Status</span>
            <span class="settings-value">
              <span class="status-dot connected" id="status-dot"></span>
              <span id="status-text">Connected</span>
            </span>
          </div>
          <div class="settings-row">
            <span class="settings-label">Pairing ID</span>
            <code id="pairing-id-display">‚Äî</code>
          </div>
          <div class="settings-actions">
            <button id="test-notification" class="settings-btn">üîî Test Notification</button>
            <button id="unpair" class="settings-btn danger">Unpair Device</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content info-modal-content">
        <div class="modal-header">
          <h2>Privacy & How It Works</h2>
          <button class="modal-close" id="close-info">‚úï</button>
        </div>
        <div class="modal-body info-modal-body">
          <img src="/assets/cc-approval-a.png" alt="Claude approval loop" class="info-illustration">
          <p>Your requests flow directly from Claude Code ‚Üí your Worker ‚Üí your phone. The Worker only stores pending requests for 60 seconds and deletes them automatically.</p>
          <ul class="info-list">
            <li>No third-party servers beyond your Cloudflare account.</li>
            <li>HMAC-signed requests with nonce + timestamp verification.</li>
            <li>Maximum of 2,000 concurrent pending approvals per pairing.</li>
          </ul>
          <div class="info-privacy-card">
            <h3>Privacy commitments</h3>
            <p>Requests live in Durable Object memory only long enough for you to act. No analytics, no tracking pixels, and you control the entire deployment.</p>
          </div>
        </div>
      </div>
    </div>

    <main id="main-content">
      <!-- Not Paired -->
      <div id="not-paired" class="card hidden">
        <h2>Get Started</h2>
        <p>Pair your device with Claude Code to receive approval requests.</p>
        <a href="/pair.html" class="button primary">Pair Device</a>
      </div>

      <!-- Paired View -->
      <div id="paired-view" class="paired-view hidden">
        <!-- Push Permission (compact banner) -->
        <div id="push-permission" class="push-banner hidden">
          <span class="push-text">üîî Enable push notifications</span>
          <button id="enable-push" class="push-btn">Enable</button>
        </div>

        <!-- Pending Requests - scrollable area -->
        <div id="pending-requests" class="pending-section">
          <div class="pending-header">
            <h2>Pending Requests</h2>
            <button id="refresh-requests" class="refresh-btn" title="Refresh">‚Üª</button>
          </div>
          <div id="requests-list" class="requests-scroll">
            <p class="no-requests">No pending requests</p>
          </div>
        </div>

      </div>
    </main>

  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
