# Claude Code Setup Prompt - Template

**This is a TEMPLATE for reference. The actual prompt is generated by the PWA with credentials embedded.**

Users should:
1. Pair their iPhone via the PWA
2. Go to Settings → Setup in the PWA
3. Copy the generated prompt (which has their credentials embedded)
4. Paste to Claude Code

---

## What the PWA Generates

The PWA generates a prompt with:
- Server URL (automatically detected)
- Pairing ID (generated during pairing)
- Pairing Secret (generated during pairing)

All credentials are embedded directly in the bash script - Claude Code just executes, no asking for info.

---

## Generated Prompt Structure

```
STEP 1: Check Dependencies
  → Claude runs dependency check
  → Waits if user needs to install anything

STEP 2: Create Hook Script
  → Claude runs cat command with embedded credentials
  → Verifies file was created

STEP 3: Configure Settings
  → Claude checks if settings.json exists
  → Creates or asks user how to merge

STEP 4: Manual Steps
  → Claude tells user to install Shortcut and create Focus Mode
  → Waits for user confirmation
  → Verifies shortcut works

STEP 5: Restart Required
  → Claude tells user to restart Claude Code
  → Hooks don't reload without restart

STEP 6: Test
  → After restart, Claude runs tests with Focus Mode ON/OFF
  → Confirms setup is complete
```

---

## The Bash Hook Script

The generated hook script includes:
- Embedded credentials (PAIRING_ID, PAIRING_SECRET, SERVER_URL)
- Focus Mode detection via Shortcuts app
- Session caching with $PPID
- HMAC-SHA256 signature generation (header-based auth)
- Polling for approval decision (120s timeout)

**Critical implementation notes:**
- Uses `API_PATH` not `PATH` (avoids shadowing system PATH)
- Uses `printf` not `echo` (no trailing newline issues)
- Decodes base64 secret to hex for openssl HMAC
- Falls back to CLI prompt if Focus Mode is off (exit 1)

---

## Focus Modes

| Mode | Name | Behavior |
|------|------|----------|
| Remote (iPhone) | `claude remote approve` | Sends push notification to iPhone |
| Off | Any other / none | Falls back to CLI prompt |

---

## Files Created

| File | Purpose |
|------|---------|
| `~/.claude-approve-hook.sh` | The approval hook script |
| `~/.claude/settings.json` | Claude Code configuration (hooks) |

---

## Source Code

The actual prompt generation code is in:
`packages/pwa/src/main.ts` → `buildSetupPrompt()` function

To modify the setup prompt, edit that function and redeploy the PWA.
